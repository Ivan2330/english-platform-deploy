# üî® –ë—ñ–ª–¥-—Ñ–∞–∑–∞
FROM node:20-alpine AS builder
WORKDIR /app

# –ê—Ä–≥—É–º–µ–Ω—Ç–∏ –¥–ª—è –±—ñ–ª–¥—É
ARG VITE_API_URL
ARG VITE_WS_URL

# –ï–∫—Å–ø–æ—Ä—Ç—É—î–º–æ —É –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —è–∫—ñ Vite –∑–º–æ–∂–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_WS_URL=$VITE_WS_URL

# –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
COPY package*.json ./
RUN npm install --legacy-peer-deps

# –ö–æ–ø—ñ—é—î–º–æ —É–≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç
COPY . .

# ‚öôÔ∏è –ë—ñ–ª–¥ –∑ Vite
RUN npm run build

# üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω-—Ñ–∞–∑–∞
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html

# –ó–∞–º—ñ–Ω—é—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é Nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
